<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ประวัติการรักษา โรงพยาบาลเปาโล โชคชัย 4</title>

  <!-- ฟอนต์สวยแบบโรงพยาบาล -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Sarabun', sans-serif;
      background: #f9fafb; /* ขาวเทา พรีเมียม */
      color: #1f2937;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }

    /* หัวข้อหลัก */
    .header {
      text-align: center;
      padding: 30px 10px;
      background: white;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .header h1 {
      font-size: 2rem;
      margin: 0;
      color: #0d47a1; /* น้ำเงินแพทย์ */
      font-weight: 600;
    }

    .header p {
      font-size: 1rem;
      margin: 5px 0 0;
      color: #6b7280;
    }

    /* Card สไตล์โรงพยาบาลเอกชน */
    .card {
      background: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }

    .card h2 {
      margin-top: 0;
      font-weight: 600;
      color: #0d47a1;
      font-size: 1.3rem;
      border-left: 6px solid #0d47a1;
      padding-left: 12px;
    }

    label {
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
      color: #374151;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      background: #ffffff;
      font-size: 1rem;
      transition: 0.2s;
    }

    input:focus, textarea:focus, select:focus {
      border-color: #0d47a1;
      outline: none;
      box-shadow: 0 0 5px rgba(13,71,161,0.2);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .two-col {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    @media (max-width: 600px) {
      .two-col { grid-template-columns: 1fr; }
    }

    button {
      padding: 10px 18px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: 0.2s;
    }

    button.primary {
      background: #0d47a1;
      color: white;
    }

    button.primary:hover { background: #0a3a85; }

    button.secondary {
      background: #e5e7eb;
      color: #374151;
    }

    button.danger {
      background: #ef4444;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.95rem;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
      vertical-align: top;
    }

    th {
      background: #f1f5f9;
      color: #0d47a1;
      font-weight: 600;
    }

    .empty {
      padding: 20px;
      text-align: center;
      background: #f1f5f9;
      border-radius: 10px;
      color: #64748b;
      font-size: 0.95rem;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- HEADER -->
    <div class="header">
      <h1>ประวัติการรักษา</h1>
      <p>โรงพยาบาลเปาโล โชคชัย 4</p>
    </div>

    <!-- ข้อมูลผู้ป่วย -->
    <div class="card">
      <h2>ข้อมูลผู้ป่วย</h2>
      <div class="two-col">
        <div>
          <label>ชื่อ - นามสกุล</label>
          <input id="patientName" placeholder="เช่น นายสมชาย ใจดี">
        </div>
        <div>
          <label>เลขที่ HN / บัตรประชาชน</label>
          <input id="patientId" placeholder="เช่น HN-001">
        </div>
        <div>
          <label>วันเกิด</label>
          <input type="date" id="patientDob">
        </div>
        <div>
          <label>เบอร์ติดต่อ</label>
          <input id="patientPhone" placeholder="เช่น 08x-xxx-xxxx">
        </div>
        <div>
          <label>โรคประจำตัว</label>
          <input id="patientChronic">
        </div>
        <div>
          <label>ประวัติแพ้ยา</label>
          <input id="patientAllergy">
        </div>
      </div>

      <label style="margin-top:10px;">หมายเหตุเพิ่มเติม</label>
      <textarea id="patientNote"></textarea>

      <div style="margin-top:12px;">
        <button class="primary" onclick="savePatientProfile()">บันทึกข้อมูลผู้ป่วย</button>
        <button class="secondary" onclick="resetPatientProfile()">ล้างฟอร์ม</button>
      </div>
    </div>

    <!-- เพิ่มประวัติ -->
    <div class="card">
      <h2>เพิ่มประวัติการรักษา</h2>

      <form id="recordForm">
        <div class="two-col">
          <div>
            <label>วันที่เข้ารับการรักษา *</label>
            <input type="date" id="visitDate" required>
          </div>
          <div>
            <label>สถานพยาบาล *</label>
            <input id="clinic" value="โรงพยาบาลเปาโล โชคชัย 4" required>
          </div>
          <div>
            <label>อาการ / การวินิจฉัย *</label>
            <input id="diagnosis" required>
          </div>
          <div>
            <label>ประเภทการรักษา</label>
            <select id="treatmentType">
              <option value="">เลือกประเภท</option>
              <option>OPD</option>
              <option>IPD</option>
              <option>ฉุกเฉิน</option>
            </select>
          </div>
          <div>
            <label>แพทย์ผู้ดูแล</label>
            <input id="doctor">
          </div>
          <div>
            <label>ยาที่ได้รับ</label>
            <input id="medications">
          </div>
        </div>

        <label style="margin-top:10px;">รายละเอียดเพิ่มเติม</label>
        <textarea id="notes"></textarea>

        <div style="margin-top:12px;">
          <button type="submit" class="primary">เพิ่มประวัติ</button>
          <button type="button" class="secondary" onclick="recordForm.reset()">ล้างฟอร์ม</button>
        </div>
      </form>
    </div>

    <!-- ตารางประวัติ -->
    <div class="card">
      <h2>รายการประวัติการรักษา</h2>

      <div id="recordsEmpty" class="empty" style="display:none;">ยังไม่มีประวัติการรักษา</div>

      <table>
        <thead>
          <tr>
            <th>วันที่</th>
            <th>สถานพยาบาล</th>
            <th>อาการ / การวินิจฉัย</th>
            <th>แพทย์ / ยา</th>
            <th>หมายเหตุ</th>
            <th>ลบ</th>
          </tr>
        </thead>
        <tbody id="recordsTable"></tbody>
      </table>

      <div style="margin-top:12px;">
        <button class="secondary" onclick="exportData()">ดาวน์โหลดข้อมูล (.json)</button>
        <button class="danger" onclick="clearAllRecords()">ลบทั้งหมด</button>
      </div>
    </div>

  </div>

<script>
  const STORAGE_KEY_RECORDS = "med_history_records_v1";
  const STORAGE_KEY_PROFILE = "med_history_patient_profile_v1";

  const recordsTableBody = document.getElementById("recordsTable");
  const recordsEmpty = document.getElementById("recordsEmpty");
  const recordForm = document.getElementById("recordForm");

  let records = [];

  window.addEventListener("DOMContentLoaded", () => {
    loadPatientProfile();
    loadRecords();
  });


  /* -------------------- Patient Profile -------------------- */
  function loadPatientProfile() {
    const raw = localStorage.getItem(STORAGE_KEY_PROFILE);
    if (!raw) return;
    const p = JSON.parse(raw);

    patientName.value = p.name || "";
    patientId.value = p.id || "";
    patientDob.value = p.dob || "";
    patientPhone.value = p.phone || "";
    patientChronic.value = p.chronic || "";
    patientAllergy.value = p.allergy || "";
    patientNote.value = p.note || "";
  }

  function savePatientProfile() {
    const profile = {
      name: patientName.value.trim(),
      id: patientId.value.trim(),
      dob: patientDob.value,
      phone: patientPhone.value.trim(),
      chronic: patientChronic.value.trim(),
      allergy: patientAllergy.value.trim(),
      note: patientNote.value.trim(),
    };
    localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile));
    alert("บันทึกข้อมูลผู้ป่วยเรียบร้อย");
  }

  function resetPatientProfile() {
    if (!confirm("ต้องการล้างฟอร์มหรือไม่?")) return;
    patientName.value = "";
    patientId.value = "";
    patientDob.value = "";
    patientPhone.value = "";
    patientChronic.value = "";
    patientAllergy.value = "";
    patientNote.value = "";
  }


  /* -------------------- Records -------------------- */
  function loadRecords() {
    const raw = localStorage.getItem(STORAGE_KEY_RECORDS);
    records = raw ? JSON.parse(raw) : [];
    renderRecords();
  }

  function saveRecords() {
    localStorage.setItem(STORAGE_KEY_RECORDS, JSON.stringify(records));
  }

  function renderRecords() {
    recordsTableBody.innerHTML = "";

    if (!records.length) {
      recordsEmpty.style.display = "block";
      return;
    }

    recordsEmpty.style.display = "none";

    records.forEach((rec) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${rec.visitDate || "-"}</td>
        <td>${rec.clinic || "-"}</td>
        <td>${rec.diagnosis || "-"}</td>
        <td>
          ${rec.doctor || "-"}<br>
          <span style="color:#64748b;">${rec.medications || ""}</span>
        </td>
        <td>${rec.notes || "-"}</td>
        <td><button class="danger" style="padding:5px 10px;" onclick="deleteRecord('${rec.id}')">ลบ</button></td>
      `;
      recordsTableBody.appendChild(tr);
    });
  }

  function deleteRecord(id) {
    if (!confirm("ลบรายการนี้หรือไม่?")) return;
    records = records.filter((r) => r.id !== id);
    saveRecords();
    renderRecords();
  }

  function clearAllRecords() {
    if (!confirm("ลบประวัติทั้งหมดถาวร?")) return;
    records = [];
    saveRecords();
    renderRecords();
  }

  recordForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const newRecord = {
      id: Date.now().toString(),
      visitDate: visitDate.value,
      clinic: clinic.value.trim(),
      diagnosis: diagnosis.value.trim(),
      treatmentType: treatmentType.value,
      doctor: doctor.value.trim(),
      medications: medications.value.trim(),
      notes: notes.value.trim(),
    };

    records.push(newRecord);
    saveRecords();
    renderRecords();
    recordForm.reset();
  });

  /* -------------------- Export -------------------- */
  function exportData() {
    const payload = {
      profile: JSON.parse(localStorage.getItem(STORAGE_KEY_PROFILE) || "{}"),
      records,
      exportedAt: new Date().toISOString(),
    };

    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "medical_history_paolo.json";
    a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
  </html>
