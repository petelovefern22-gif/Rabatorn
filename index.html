<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ประวัติการรักษา - โรงพยาบาลเปาโล โชคชัย 4</title>

  <style>
    body {
      margin: 0;
      background: #fafafa;
      font-family: "Sarabun", sans-serif;
      color: #333;
    }

    .header {
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: white;
      padding: 24px 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .header h1 {
      margin: 0;
      font-size: 1.9rem;
      font-weight: 700;
    }

    .sub {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-top: 4px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.06);
      margin-top: 20px;
      border: 1px solid #e5e7eb;
    }

    h2 {
      font-size: 1.3rem;
      margin-bottom: 16px;
      color: #1e3a8a;
      border-left: 5px solid #2563eb;
      padding-left: 10px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #444;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #cbd5e1;
      background: #f8fafc;
      font-size: 0.95rem;
      transition: 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #2563eb;
      background: #fff;
      outline: none;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .btn {
      background: #2563eb;
      border: none;
      padding: 10px 16px;
      color: white;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: 0.2s;
    }

    .btn:hover {
      background: #1e3a8a;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    th, td {
      padding: 12px 8px;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      background: #f1f5f9;
      color: #1e3a8a;
      font-weight: 600;
    }

    .empty {
      text-align: center;
      padding: 14px;
      color: #666;
      font-size: 0.9rem;
      border: 1px dashed #cbd5e1;
      border-radius: 12px;
      margin-top: 12px;
    }

    .danger {
      background: #dc2626 !important;
    }

    .wrap {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

  </style>
</head>

<body>

  <!-- Header -->
  <div class="header">
    <h1>ประวัติการรักษา</h1>
    <div class="sub">โรงพยาบาลเปาโล โชคชัย 4</div>
  </div>

  <div class="container">

    <!-- Patient Info -->
    <div class="card">
      <h2>ข้อมูลผู้ป่วย</h2>

      <label>ชื่อ - นามสกุล</label>
      <input id="patientName" placeholder="เช่น นายสมชาย ใจดี">

      <label style="margin-top:10px;">รหัสผู้ป่วย / เลขที่บัตร</label>
      <input id="patientId">

      <label style="margin-top:10px;">เบอร์โทร</label>
      <input id="patientPhone">

      <label style="margin-top:10px;">ประวัติแพ้ยา</label>
      <input id="patientAllergy" placeholder="เช่น แพ้เพนิซิลลิน">

      <div class="wrap">
        <button class="btn" onclick="saveProfile()">บันทึกข้อมูลผู้ป่วย</button>
      </div>
    </div>

    <!-- Add Record -->
    <div class="card">
      <h2>เพิ่มประวัติการรักษา</h2>

      <label>วันที่รับการรักษา</label>
      <input type="date" id="visitDate">

      <label style="margin-top:10px;">การวินิจฉัยโรค / อาการ</label>
      <input id="diagnosis">

      <label style="margin-top:10px;">แพทย์ผู้รักษา</label>
      <input id="doctor">

      <label style="margin-top:10px;">ยาที่ได้รับ</label>
      <input id="medications">

      <label style="margin-top:10px;">หมายเหตุ</label>
      <textarea id="notes"></textarea>

      <div class="wrap">
        <button class="btn" onclick="addRecord()">เพิ่มประวัติ</button>
      </div>
    </div>

    <!-- Table -->
    <div class="card">
      <h2>รายการประวัติการรักษา</h2>
      <div id="empty" class="empty" style="display:none;">ยังไม่มีข้อมูล</div>

      <table id="recordsTable">
        <thead>
          <tr>
            <th>วันที่</th>
            <th>การวินิจฉัย</th>
            <th>แพทย์</th>
            <th>ยา</th>
            <th>หมายเหตุ</th>
            <th>ลบ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="wrap">
        <button class="btn danger" onclick="clearAll()">ลบทั้งหมด</button>
      </div>

    </div>
  </div>

  <script>
    const KEY = "paolo_records_v1";
    const PROFILE_KEY = "paolo_profile_v1";
    let records = [];

    // Load data
    window.onload = () => {
      loadProfile();
      loadRecords();
    };

    function saveProfile() {
      const data = {
        name: patientName.value.trim(),
        id: patientId.value.trim(),
        phone: patientPhone.value.trim(),
        allergy: patientAllergy.value.trim()
      };
      localStorage.setItem(PROFILE_KEY, JSON.stringify(data));
      alert("บันทึกข้อมูลผู้ป่วยแล้ว");
    }

    function loadProfile() {
      const raw = localStorage.getItem(PROFILE_KEY);
      if (!raw) return;
      const p = JSON.parse(raw);
      patientName.value = p.name || "";
      patientId.value = p.id || "";
      patientPhone.value = p.phone || "";
      patientAllergy.value = p.allergy || "";
    }

    function addRecord() {
      const rec = {
        id: Date.now(),
        date: visitDate.value,
        diagnosis: diagnosis.value.trim(),
        doctor: doctor.value.trim(),
        meds: medications.value.trim(),
        notes: notes.value.trim()
      };

      if (!rec.date || !rec.diagnosis) {
        alert("กรุณากรอกวันที่และการวินิจฉัย");
        return;
      }

      records.push(rec);
      saveRecords();
      render();
      visitDate.value = diagnosis.value = doctor.value = medications.value = notes.value = "";
    }

    function saveRecords() {
      localStorage.setItem(KEY, JSON.stringify(records));
    }

    function loadRecords() {
      const raw = localStorage.getItem(KEY);
      records = raw ? JSON.parse(raw) : [];
      render();
    }

    function render() {
      const body = document.querySelector("#recordsTable tbody");
      body.innerHTML = "";

      if (records.length === 0) {
        empty.style.display = "block";
        return;
      } else empty.style.display = "none";

      records.forEach(r => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${r.date}</td>
          <td>${r.diagnosis}</td>
          <td>${r.doctor || "-"}</td>
          <td>${r.meds || "-"}</td>
          <td>${r.notes || "-"}</td>
          <td><button class="btn danger" style="padding:4px 10px;font-size:0.8rem;" onclick="del(${r.id})">ลบ</button></td>
        `;

        body.appendChild(tr);
      });
    }

    function del(id) {
      records = records.filter(r => r.id !== id);
      saveRecords();
      render();
    }

    function clearAll() {
      if (!confirm("ต้องการลบทั้งหมด?")) return;
      records = [];
      saveRecords();
      render();
    }
  </script>

</body>
</html>
